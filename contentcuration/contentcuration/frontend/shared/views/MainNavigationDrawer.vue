<template>

  <div>
    <VNavigationDrawer
      v-model="drawer"
      fixed
      temporary
      style="z-index: 1000;"
      :right="$isRTL"
    >
      <VToolbar color="primary" dark>
        <VBtn flat icon :tabindex="handleclickTab" @click="drawer = false">
          <Icon>clear</Icon>
        </VBtn>
        <VToolbarTitle class="notranslate">
          Kolibri Studio
        </VToolbarTitle>
      </VToolbar>
      <VList>
        <VListTile :href="channelsLink" :tabindex="handleclickTab">
          <VListTileAction>
            <Icon>home</Icon>
          </VListTileAction>
          <VListTileContent class="subheading">
            <VListTileTitle>{{ $tr('channelsLink') }}</VListTileTitle>
          </VListTileContent>
        </VListTile>
        <VListTile v-if="user.is_admin" :href="administrationLink" :tabindex="handleclickTab">
          <VListTileAction>
            <Icon>people</Icon>
          </VListTileAction>
          <VListTileContent class="subheading">
            <VListTileTitle>{{ $tr('administrationLink') }}</VListTileTitle>
          </VListTileContent>

        </VListTile>
        <VListTile :href="settingsLink" :tabindex="handleclickTab" @click="trackClick('Settings')">
          <VListTileAction>
            <Icon>settings</Icon>
          </VListTileAction>
          <VListTileContent class="subheading">
            <VListTileTitle>{{ $tr('settingsLink') }}</VListTileTitle>
          </VListTileContent>
        </VListTile>
        <VListTile @click="showLanguageModal = true">
          <VListTileAction>
            <Icon>language</Icon>
          </VListTileAction>
          <VListTileContent class="subheading">
            <VListTileTitle v-text="$tr('changeLanguage')" />
          </VListTileContent>
        </VListTile>
        <VListTile
          :href="helpLink" 
          :tabindex="handleclickTab" 
          target="_blank"
          @click="trackClick('Help')"
        >
          <VListTileAction>
            <Icon>open_in_new</Icon>
          </VListTileAction>
          <VListTileContent class="subheading">
            <VListTileTitle>{{ $tr('helpLink') }}</VListTileTitle>
          </VListTileContent>
        </VListTile>
        <VListTile @click="logout">
          <VListTileAction>
            <Icon>exit_to_app</Icon>
          </VListTileAction>
          <VListTileContent class="subheading">
            <VListTileTitle>{{ $tr('logoutLink') }}</VListTileTitle>
          </VListTileContent>
        </VListTile>
      </VList>
      <VContainer>
        <KolibriLogo :height="75" />
        <ActionLink
          :text="$tr('copyright', { year: new Date().getFullYear() })"
          href="https://learningequality.org/"
          target="_blank"
          :tabindex="handleclickTab"
        />
        <p class="mt-4">
          <ActionLink
            href="https://community.learningequality.org/c/support/studio"
            target="_blank"
            :text="$tr('giveFeedback')"
            :tabindex="handleclickTab"
          />
        </p>
      </VContainer>

    </VNavigationDrawer>

    <LanguageSwitcherModal
      v-if="showLanguageModal"
      :style="{ color: $themeTokens.text }"
      @cancel="showLanguageModal = false"
    />

  </div>

</template>


<script>

  import { mapActions, mapState } from 'vuex';
  import KolibriLogo from './KolibriLogo';
  import LanguageSwitcherModal from 'shared/languageSwitcher/LanguageSwitcherModal';

  export default {
    name: 'MainNavigationDrawer',
    components: {
      KolibriLogo,
      LanguageSwitcherModal,
    },
    props: {
      value: {
        type: Boolean,
        default: false,
      },
    },
    data() {
      return {
        showLanguageModal: false,
      };
    },
    computed: {
      ...mapState({
        user: state => state.session.currentUser,
      }),
      handleclickTab() {
        if (this.value) {
          return 0;
        } else {
          return -1;
        }
      },
      drawer: {
        get() {
          return this.value;
        },
        set(value) {
          this.$emit('input', value);
        },
      },
      channelsLink() {
        return window.Urls.channels();
      },
      administrationLink() {
        return window.Urls.administration();
      },
      settingsLink() {
        return window.Urls.settings();
      },
      helpLink() {
        return 'https://kolibri-studio.readthedocs.io/en/latest/index.html';
      },
    },
    methods: {
      ...mapActions(['logout']),
      trackClick(label) {
        this.$analytics.trackClick('general', `User dropdown - ${label}`);
      },
    },
    $trs: {
      channelsLink: 'Channels',
      administrationLink: 'Administration',
      settingsLink: 'Settings',
      changeLanguage: 'Change language',
      helpLink: 'Help and support',
      logoutLink: 'Sign out',
      copyright: 'Â© {year} Learning Equality',
      giveFeedback: 'Give feedback',
    },
  };

</script>


<style lang="less" scoped>

</style>
